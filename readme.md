#LOKIREL

#API

##Авторизация

###Регистрация админа

`POST /register`

Регистрирует пользователя с ролью ROLE_ADMIN.

Параметры:

* `email`
* `password`

###Вход админа

`POST /login`

Дает сессионный куки.

Параметры:

* `lemail`
* `lpassword`

###Выход

`POST /logaut`

Удаляет сессионный куки

##Обратная связь

###Форма обратной связи

`POST /feedback`

Отправляет email админу с информацией из формы, дублирует запись в бд.

Параметры:

* `fname`
* `femail`
* `ftel`
* `ftext`
* `fmailing`

##Блог

###Получить посты

`POST /blog`

Возвращает последние посты, имеет поиск по тэгам, категориям, ключевой фразе, пагинацию.

Параметры:

* `page` номер страницы
* `perPage` количество постов на странице, по умолчанию 12
* `tags` массив с slug тегов
* `categories` массив с slug категорий
* `search` слово или фраза для поиска в заголовках или теле статей

Пример:

```
{
    "perPage": "12",
    "categories": [
        "home"
    ]
}
```

В ответе приходит массив постов. О посте подробнее ниже. Ответ:

```
[
    ...
    {
        "id": 3,
        "title": "new post",
        "slug": "new_post",
        "created": "300000",
        "updated": null,
        "hidden": false,
        "body": [
            {
                "id": 5,
                "type": "1",
                "text": "first block",
                "images": []
            },
            {
                "id": 6,
                "type": "1",
                "text": "first block",
                "images": []
            }
        ]
    }
    ...
]
```

###Получить пост

`POST /blog/post`

Возвращает один пост.

Параметры:

* `slug` slug поста (из адресной строки)

Ответ:

```
{
    "id": 1, // id поста
    "title": "Some new post", // заголовок поста
    "slug": "some_new_post", // slug поста
    "created": "0", // ts создания поста
    "updated": null, // ts изменения поста
    "hidden": false, // спрятан ли пост
    "body": [ // тело поста - массив блоков поста
        {
            "id": 1, // id блока поста
            "type": "1" //, тип блока поста
            "text": "Saorana", // текст блока поста
            "priority": null, // порядок вывода блока поста
            "images": [] // массив изображений поста
        },
        {
            "id": 2,
            "type": "1",
            "text": "Kaori",
            "priority": null,
            "images": []
        }
    ]
}
```

###Создать пост

`POST /blog/create`

Параметры:

* `title` заголовок поста
* `cover` картинка поста
* `slug` slug поста - уникальное, для адресной строки
* `blocks` массив блоков поста, в каждом блоке:
* `- text` текст блока
* `- type` тип блока
* `- priority` порядок блока по отношению к другим, 0 идет первым
* `- images` массив айди изображений блока

Пример:
```
{
    "title":"new post",
    "cover":"1",
    "slug":"new_post3",
    "blocks":[
        {
            "text":"first4 block",
            "type": "1",
            "images": []
        },
        {
            "text":"first 3block",
            "type": "1",
            "images": []
        }
    ]
}
```

Ответ:

```
{
    "id": 4,
    "title": "new post",
    "slug": "new_post3",
    "created": "300000",
    "updated": null,
    "hidden": false,
    "body": [
        {
            "id": 12,
            "type": "1",
            "text": "first4 block",
            "priority": 0,
            "images": []
        },
        {
            "id": 13,
            "type": "1",
            "text": "first 3block",
            "priority": 1,
            "images": []
        }
    ]
}
```

###Удалить пост

`POST /blog/delete`

Параметры:

* `post_id` id удаляемого поста

###Изменить пост

`POST /blog/update`

Передаются только измененные параметры, если менялись блоки то передавать все блоки полностью. Если блок передан без id то будет добавлен новый блок. Если прошлый блок не найден в новых блоках, то он удаляется.

Параметры:

* `post_id` id поста
* `title` заголовок поста
* `cover` картинка поста
* `slug` slug поста
* `hidden` скрыт ли пост
* `blocks` - массив блоков поста
* `- id` id блока поста
* `- text` текст блока поста
* `- type` тип блока поста
* `- priority` порядок вывода блока поста
* `- images` массив изображений блока поста

